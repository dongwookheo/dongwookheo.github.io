---
title: "[T-PAMI 2015] Map-Based Probabilistic Visual Self-Localization"
excerpt: "Map-based Visual Localization"
categories:
  - 논문리뷰
  - Computer Vision
tags:
  - Map-based Visual Localization
  - Visual Odometry
layout: single
use_math: true
date: 2025-08-09
last_modified_at: 2025-08-09
classes: wide
---

> Author: Marcus A. Brubaker; Andreas Geiger; Raquel Urtasun  
> July 2015  
> T-PAMI [[DOI](https://doi.org/10.1109/TPAMI.2015.2453975)] [[CODE](https://www.cs.toronto.edu/~mbrubake/projects/map/)]

[![Video Label](http://img.youtube.com/vi/xpVxTMJENg4/0.jpg)](https://youtu.be/xpVxTMJENg4)

## 서론
**자율 시스템의 자기 위치 결정의 중요성 및 기존 기술의 한계**

자율 시스템에서 정확하고 효율적인 자기 위치 결정은 핵심적인 과제이다. 이 논문은 두 대의 비디오 카메라와 도로 지도를 유일한 입력으로 사용하여 차량의 자기 위치를 파악하는 저렴한 해결책을 제시한다.

**기존 기술의 문제점**
- **GPS의 한계**: 저렴하지만 신호가 항상 가용하지 않거나, 고층 빌딩, 터널, 전파 방해 등으로 인해 정밀도가 떨어질 수 있다. 이는 자율 장치에 치명적인 결과를 초래할 수 있다.
- **기존 시각 기반 접근 방식**: 대부분 세계의 외관에 대한 방대한 사전 지식을 요구하며, 데이터 유지 및 개인 정보 보호 측면에서 문제가 발생할 수 있다.

**본 논문의 기여**
- **이전에 보지 못한 장소에서의 위치 파악**: 본 연구는 이전에 한 번도 방문한 적 없는 장소에서도 차량의 위치를 파악할 수 있는 저렴하고 강건한 해결책을 제안한다.

- **OpenStreetMap(OSM) 활용**: 무료로 이용 가능하고 지속적으로 업데이트되는 OSM을 활용하여 비용 효율적인 접근 방식을 가능하게 한다.

- **확률 모델 및 효율적인 추론**: 시각적 주행 거리 측정의 노이즈와 지도 내의 모호성(예: 맨해튼 월드)에 강건하게 대응하는 확률 모델과 효율적인 근사 추론 알고리즘을 제안한다.

- **실시간 성능**: 알고리즘은 분산 컴퓨팅을 활용하여 자율 시스템의 실시간 요구 사항을 충족할 수 있다.

- **정확도**: 2,150km 이상의 도로를 포함하는 지도에서 52초 주행 후 평균 4m 이내의 정확도로 차량을 위치 파악할 수 있음을 입증한다.

## Visual Localization
### 확률기반 접근 방식과 지도 표현
차량의 자기 위치 결정을 위해 차량의 지붕에 장착된 카메라와 환경의 지도 정보를 활용한다. 지도는 도로와 교차점을 포함하지만, 시각적 외관 정보는 포함하지 않으므로, 차량의 궤적만이 자기 위치 결정에 사용 가능한 유일한 정보이다. 이를 위해 시각적 주행 거리 측정 (visual odometry)이 활용된다.

**확률적 자기 위치 결정**:
시각적 주행 거리 측정의 적분은 드리프트를 유발하여 대규모 지도에서 직접적인 형태 매칭을 어렵게 한다. 따라서 본 논문은 시각적 주행 거리 측정값을 사용하여 차량의 순간적인 위치와 방향을 결정하는 확률적 접근 방식을 제안한다.

<p align="center">
  <img src="/assets/images/pami15_lost/img2.png" alt="map" style="width: 80%;">
</p>

**지도 표현**:
지도는 방향성 그래프 (directed graph)로 표현되며, 노드는 도로 구간을, 엣지는 이들 구간의 연결성을 정의한다.
모든 도로 구간은 선형 또는 원호세그먼트로 표현되며, 다음 매개변수들로 정의된다.
교차로는 원형 호로 '부드럽게' 처리되어 차선 기반의 지도 표현을 얻는다.

<p align="center">
  <img src="/assets/images/pami15_lost/img3.png" alt="map" style="width: 80%;">
</p>

**도로 구간 모델링**:
모든 도로 구간은 선형 또는 원호세그먼트로 표현되며, 다음 매개변수들로 정의된다.
- 시작점 ($p_0$), 끝점 ($p_1$)
- 길이 ($\ell$)
- 초기 방향 ($\beta$)
- 곡률 ($\alpha$): 선형 세그먼트의 경우 $\alpha=0$이며, 원호세그먼트의 경우 $\alpha = \frac{\psi_1 - \psi_0}{\ell}$ (여기서 $\psi_0, \psi_1$은 시작 및 끝 각도)

**차량 상태 및 전역 위치/방향 계산**:
차량의 상태는 주행 중인 도로 구간 ($u$), 해당 구간 시작점으로부터의 거리 ($d$), 지역 도로 방향에 대한 차량의 각도 오프셋 ($\theta$)으로 정의된다.
- **전역 방향**: $\bar{\theta} = \theta + \beta + \alpha d$
- **전역 위치**:
  - 선형 세그먼트: $\bar{p} = p_0 + \frac{d}{\ell}(p_1 - p_0)$
  - 원호세그먼트: $\bar{p} = c + r d(\psi_0 + \frac{d}{\ell}(\psi_1 - \psi_0))$ (여기서 $c$는 원의 중심, $r$은 반지름, $d(\psi) = (\cos\psi, \sin\psi)^\top$)

### 상태 공간 및 추론 알고리즘
차량의 움직임은 이산 시간 모델로 표현되며, 상태 $x_t = (u_t, s_t)$는 현재 도로 구간 ($u_t$)과 해당 구간 내의 상태 ($s_t = (d_t, \dot{d}_t, \theta_t, \dot{\theta}_t)$)를 포함한다.

**상태 전이 모델**: $p(x_t|x_{t-1}) = p(u_t|x_{t-1})p(s_t|u_t, x_{t-1})$
- 상태 전이 분포는 선형 변환에 가우시안 노이즈가 더해진 형태로 가정된다: $p(s_t|u_t, x_{t-1}) = \mathcal{N}(s_t | A_{u_t,u_{t-1}}s_{t-1} + b_{u_t,u_{t-1}}, \Sigma_{s_{u_t}})$
- **거리 변화 모델**: 2차, 상수 속도 모델 ($d_t = d_{t-1} + (\dot{d}_{t-1} - \dot{d}_{t-2})$)
- **각도 변화 모델**: 1차 자기회귀 모델(AR(1)) ($\theta_t = \gamma_{u_t}\theta_{t-1}$)
- $\mathbf{A}_{u_t,u_{t-1}} = \begin{bmatrix} 2 & -1 & 0 & 0 \\ 1 & 0 & 0 & 0 \\ 0 & 0 & \gamma_{u_t} & 0 \\ 0 & 0 & 0 & 0 \end{bmatrix}$
- $\mathbf{b}_{u_t,u_{t-1}} = \begin{cases} -(\ell_{u_t}^{-1}, \ell_{u_t}^{-1}, 0, \theta_{u_t,u_{t-1}})^\top & u_t \neq u_{t-1} \\ (0,0,0,0)^\top & u_t = u_{t-1} \end{cases}$

$\theta_{u_t,u_{t-1}}$는 이전 도로 구간의 끝과 현재 도로 구간의 시작 사이의 각도이다.

**추론 알고리즘**: 필터링 분포 $p(x_t|y_{1:t})$는 예측 단계와 업데이트 단계로 나뉘어 재귀적으로 계산된다.
- **예측 단계**:
  - 대부분의 경우, 전이 확률의 시그모이드 형태 때문에 분석적 근사 (analytic approximation)가 사용된다.
  - 전이 확률의 변곡점 근처에서 모드가 겹치면 몬테카를로 근사 (Monte Carlo approximation)를 통해 정확도를 유지한다.
- **업데이트 단계**: 예측된 모드에 관측 $y_t$를 반영하여 업데이트한다. 이는 가우시안 밀도를 곱하는 것과 유사하며, 칼만 필터의 업데이트와 유사한 방식으로 진행된다.
- **후방 분포 복잡도 관리**:
  - 후방 분포의 혼합 성분 수가 지수적으로 증가하는 것을 막기 위해 세 가지 근사화를 사용한다.
  - **모드 병합**: 유사한 모드들을 단일 성분으로 병합한다.
  - **가지치기**: 확률이 임계값 이하인 도로의 혼합 성분들을 제거한다.
  - **혼합 모델 단순화 (GMM simplification)**: 혼합 성분 수가 너무 많아질 때, KL 발산(Kullback-Leibler divergence)을 특정 임계값($\epsilon$) 이하로 유지하면서 성분들을 제거하거나 업데이트하는 절차를 수행한다.
    - KL 발산 상한은 $D(f||g) \le \hat{D}(\phi, \psi, M, M')$으로 주어진 변분 파라미터($\phi, \psi$)로 최소화된다.
    - 단순화된 GMM의 각 성분 파라미터는 다음 식을 통해 반복적으로 업데이트된다:  
    $\mu_b = \frac{\sum_a \phi_{a,b}\mu_a}{\sum_a \phi_{a,b}}$,
    $\Sigma_b = \frac{\sum_a \phi_{a,b}(\Sigma_a + (\mu_a - \mu_b)(\mu_a - \mu_b)^\top)}{\sum_a \phi_{a,b}}$
- **병렬 처리**: 이 알고리즘은 병렬 처리가 가능하도록 설계되어 실시간 성능을 달성한다.

## 실험 평가
제안된 위치 결정 방법은 KITTI 시각 주행 거리 측정 데이터셋을 사용하여 평가된다.

**실험 설정**
- KITTI 데이터셋의 11개 훈련 시퀀스를 활용했다.
- LIBVISO2 라이브러리를 통해 모노큘러 및 스테레오 시각 주행 거리 측정값을 계산했다.
- 계산 시간 단축을 위해 시각 주행 거리 측정값은 초당 1프레임으로 서브샘플링되었다.

**평가 지표**: 위치 및 방향 오차는 시스템이 'localized'된 후 (후방 분포가 10초 이상 단일 모드를 유지) 계산된다.
- **오라클 (oracle) 오차**: GPS 데이터를 지도에 투영하여 계산된 재투영 오차로, 주어진 지도 데이터로 달성 가능한 최상의 오차를 나타낸다.

아래는 정량 평가 결과 (Table 1)이다.

<p align="center">
  <img src="/assets/images/pami15_lost/img4.png" alt="table1" style="width: 80%;">
</p>

스테레오 시각 주행 거리 측정 결과는 오라클 오차의 표준 편차(±2.2m) 범위 내에 있어, 지도 및 GPS 데이터의 부정확성으로 인한 이론적 한계에 근접한 성능을 보여준다.
모노큘러 주행 거리 측정은 시퀀스 01(고속도로 고속 주행) 및 08(이상치 발생)에서 누적 오차로 인해 성능이 좋지 않았다.

**식별 가능한 시퀀스 분석**:
- **모호한 시퀀스 (04, 06)**: 짧은 직선 도로(04) 또는 대칭 경로(06)는 근본적인 모호성으로 인해 위치 파악이 불가능했다.
- **빠르게 위치 파악되는 시퀀스 (02, 10)**: 곡선 도로를 통과하여 빠르게 고유하게 식별되었다.
- **오래 걸리는 시퀀스 (01, 08)**: 긴 직선 구간은 위치 파악이 어렵다.

**단순화 임계값 ($\epsilon$) 영향**:
- $\epsilon$이 커질수록 계산 시간은 감소하고 오차는 증가한다.
- $\epsilon = 10^{-2}$ nats에서 계산 시간과 오차 간의 균형이 가장 좋았다.

**지도 크기 영향**: 초기 영역 크기가 작을수록 위치 파악 시간이 빠르지만, 일정 크기(약 2km²) 이상에서는 지도 크기가 위치 파악 시간에 미치는 영향이 미미해졌다.

**노이즈에 대한 강인성**: GPS 기반 주행 거리 측정값에 가우시안 노이즈를 추가한 결과, SNR(신호 대 잡음비)이 1 이하로 떨어지기 전까지는 오차 변화가 작아 성능이 노이즈에 강인함을 보여준다.

## 결론
이 논문은 카메라와 크라우드소싱 기반의 무료 온라인 지도를 활용한 자기 위치 결정접근 방식을 제시한다.

**연구의 의의**:
- 고속도로, 교외, 혼잡한 도시 등 다양한 시나리오에서 성공적으로 적용되었다.  
- KITTI 벤치마크에서 평균 4m의 정밀도로 1분 이내에 차량 위치를 파악하는 뛰어난 성능을 입증했다.

**향후 연구 방향**:
- **노이즈 모델 개선**: 모노큘러 주행 거리 측정에서 주기적으로 발생하는 큰 이상치(outlier)를 고려하여, 관측 노이즈의 heavy-tailed 특성을 다루는 모델 확장을 통해 강인성을 향상시킬 수 있다.
- **추가 시각적 단서 통합**: OpenStreetMap에 포함된 속도 제한, 도로명 등 추가적인 시각적 단서를 활용하여 위치 결정 정확도를 더욱 높일 수 있다.
